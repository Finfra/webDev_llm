# MCP(Model Context Protocol) 개요와 실습

## 1. MCP란 무엇인가?
* MCP는 LLM을 사용할 때 발생하는 컨텍스트 손실 문제를 해결하기 위한 프로토콜임. 
* 대화의 흐름을 유지하면서 이전 맥락을 지속적으로 반영할 수 있도록 설계되었음. 
* 주로 Agent 시스템, 멀티 모달 인터페이스, 연속 작업 흐름에 활용됨. 

## 2. MCP가 필요한 이유
* LLM은 입력 토큰 수에 따라 컨텍스트를 기억하는 데 한계가 있음. 
* 긴 대화나 연속 작업 시 앞선 내용이 누락되면 사용자의 의도를 정확히 이해하지 못함. 
* 이를 해결하기 위해 과거 대화를 압축·요약하여 지속적으로 반영하는 MCP가 필요함. 

## 3. MCP가 해결하는 문제
* **장기 기억 손실 방지**: 이전 대화 내용을 잊지 않도록 요약·저장함. 
* **컨텍스트 흐름 유지**: 현재 작업과 관련된 정보만 선별하여 반영함. 
* **사용자 맞춤화**: 사용자 프로필이나 이전 기록을 기반으로 응답을 정교화함. 
* **다중 에이전트 협업**: 여러 에이전트 간의 맥락 공유를 가능하게 함. 

## 4. LLM Agent에서 MCP 적용 방식
* **Context Manager**: 최근 대화와 관련된 핵심 정보를 요약하여 저장함. 
* **Retriever**: 대화 시점에 맞는 과거 컨텍스트를 찾아서 삽입함. 
* **Memory Compression**: 이전 대화 내용을 압축해 context limit에 맞게 조정함. 
* **Prompt Augmentation**: 요약된 컨텍스트를 system prompt나 user prompt에 자동 삽입함. 

## 5. 대표적인 MCP 지원 앱 목록
| 앱 이름                       | MCP 지원 방식                                | 비고                            |
| ----------------------------- | -------------------------------------------- | ------------------------------- |
| **Claude Desktop**            | `mcp-config.json` 파일을 통한 서버 설정      | 공식 데스크탑 앱, Claude 3 지원 |
| **Cursor AI**                 | `.cursor/context` 기반 대화 흐름 유지        | 코드 기반 LLM IDE               |
| **Cline (VSCode)**            | `.cline/config.yaml` 기반 커스텀 메모리 설정 | 터미널 기반 AI 코드 인터페이스  |
| **Obsidian + Smart Composer** | 노트 기반 컨텍스트 연동                      | 플러그인 설치 필요              |
| **n8n Agent Flow**            | 노드 간 context 전달 및 저장 기능            | MCP 구조 커스터마이징 가능      |

---

## 6. 실습: Claude Desktop에서 MCP 설정 및 활용

본 실습은 Claude Desktop 애플리케이션이 설치되어 있어야 진행할 수 있음. 

### 실습 목표
* Claude Desktop에서 MCP를 활성화하고 기본 기능을 이해함. 
* 파일 시스템 접근(`filesystem`) 및 웹 검색(`web-search`) MCP 서버를 설정하고 테스트함. 

### 단계 1: Claude Desktop 설치
* [claude.ai/download](https://claude.ai/download)에 접속하여 본인 운영체제에 맞는 설치 파일을 다운로드 후 실행함. 
* 로그인하여 Claude 챗 인터페이스를 실행함. 

### 단계 2: MCP 설정 파일 준비
1.  Claude Desktop은 특정 경로에 있는 `mcp-config.json` 파일을 읽어 MCP 서버를 자동으로 실행함. 
2.  `part4.LlmAgent/4.1.src/mcp-config.json` 파일을 Claude 설정 폴더로 복사하거나, 아래 내용을 참고하여 직접 파일을 생성함. 
    *   **macOS:** `~/Library/Application Support/claude/mcp-config.json`
    *   **Windows:** `%APPDATA%\claude\mcp-config.json`

**`mcp-config.json` 내용:**
```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-filesystem",
        "/Users/nowage/df" 
      ]
    },
    "web-search": {
      "command": "npx",
      "args": [
        "-y", 
        "@modelcontextprotocol/server-web-search"
      ],
      "env": {
        "BRAVE_API_KEY": "your_brave_api_key_here"
      }
    }
  }
}
```
*   **주의:** `filesystem` 서버의 경로 (`/Users/nowage/df`)는 실제 접근하려는 디렉토리의 **절대 경로**로 수정해야 함. 
*   **주의:** `web-search`를 사용하려면 [Brave Search API](https://brave.com/search/api/)에서 API 키를 발급받아 `your_brave_api_key_here` 부분을 교체해야 함. 

### 단계 3: MCP 기능 테스트
Claude Desktop을 재시작하면 MCP 서버가 활성화됨.  이제 아래와 같은 프롬프트를 사용하여 기능을 테스트할 수 있음. 

**1. 파일 시스템 접근 테스트:**
`mcp-config.json`에 설정한 경로에 테스트용 파일을 몇 개 생성한 후, Claude에 다음과 같이 질문해 보세요.
```
@fs //
```
위 명령어는 설정된 파일 시스템의 루트 디렉토리 목록을 보여줌.  특정 파일의 내용을 읽으려면 다음과 같이 입력함. 
```
@fs /path/to/your/file.txt
```

**2. 웹 검색 테스트:**
Brave API 키를 설정했다면, 웹 검색을 테스트할 수 있음. 
```
@web "Latest AI news"
```

## 7. 결론
MCP는 Claude와 같은 LLM Agent의 기능을 크게 확장시켜주는 강력한 프로토콜임.  파일 시스템 접근, 웹 검색 등 다양한 기능을 통해 단순한 챗봇을 넘어 생산성 도구로 활용할 수 있음. 